spec_version: 2-preview

description: test blueprint for deploying VMs on vcenter


inputs:
  vm_template_name:
    display-style: normal
    type: string
    default: Centos
    description: there is no sanctuary
  network_name:
    display-style: normal
    type: string
    description: there is no sanctuary
  vm_folder_path:
    display-style: normal
    type: string
    default: Alexey.B
    description: there is no sanctuary
  requested_vm_address:
    display-style: normal
    type: string
    default: ""
    description: there is no sanctuary
  is_linked_clone:
    display-style: normal
    type: string
    default: false
    description: there is no sanctuary
  qualix_ip:
    display-style: normal
    type: string
    default: ""
    description: there is no sanctuary
  wait_for_ip:
    type: string
    default: 120
  wait_for_net:
    type: string
    default: 120
grains:
  vm1:
    kind: terraform
    spec:
      inputs:
        - vc_address: "{{ .params.vcenter_host }}"
        - vc_username: "{{ .params.vcenter_user }}"
        - vc_password: "{{ .params.vcenter_password }}"
        - vm_template_name: '{{ .inputs.vm_template_name }}'
        - vm_name: "TorqueTestVM-{{ sandboxid }}"
        - vc_dc_name: "{{ .params.vc_datacenter }}"
        - vc_ds_name: "{{ .params.vc_datastore }}"
        - compute_cluster_name: "{{ .params.vc_cluster }}"
        - network_name: '{{ .inputs.network_name }}'
        - wait_for_ip: '{{ .inputs.wait_for_ip }}'
        - wait_for_net: '{{ .inputs.wait_for_net }}'
        - vm_folder_path: '{{ .inputs.vm_folder_path }}'
        - requested_vm_address: '{{ .inputs.requested_vm_address }}'
        - is_linked_clone: '{{ .inputs.is_linked_clone }}'
        - qualix_ip: '{{ .inputs.qualix_ip }}'

      outputs:
        - vsphere_virtual_machine_name
        - vsphere_virtual_machine_ip
        - remote_access_link

      tags:
        auto-tag: false

      source:
        store: torque-tf-blueprints
        path: terraform/vcenter/generic
      agent:
        name: vcenter-agent